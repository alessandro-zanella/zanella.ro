<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Zanella Lounge</title>
  <meta name="description" content="Zanella Lounge — a smart‑casual lounge to eat, drink, and socialize in an elegant, modern setting." />
  <!-- PWA / mobile chrome hints -->
  <meta name="theme-color" content="#171b1f">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <div class="ambient" aria-hidden="true"></div>
  <canvas id="particles" aria-hidden="true"></canvas>

  <div class="nav">
    <div class="container nav-inner">
      <a href="/index.html" class="brand" aria-label="Zanella">
        <img src="assets/ZANELLA%20LOGO%20WHITE.png" alt="Zanella Lounge" style="padding:5px; padding-right:40px; height:28px; display:block; object-fit:contain;">
      </a>
      <nav style="display:flex; gap:1rem; align-items:center;" aria-label="Primary">
        <div class="nav-links" style="display:flex; gap:1rem; align-items:center">
          <a href="#about">About</a>
          <a href="#menuSection">Menu</a>
          <a href="#contact">Contact</a>
        </div>
        <div class="nav-social" style="display:flex; gap:.6rem; align-items:center; margin-left:12px">
          <a href="https://www.instagram.com/zanella_lounge/" aria-label="Instagram" target="_blank" rel="noopener" style="color:var(--muted); display:inline-flex; align-items:center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 6.2a4.2 4.2 0 1 0 0 8.4 4.2 4.2 0 0 0 0-8.4zm4.2-2.6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>
          </a>
          <a href="https://www.facebook.com/profile.php?id=61580371774552" aria-label="Facebook" target="_blank" rel="noopener" style="color:var(--muted); display:inline-flex; align-items:center;">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v7h4v-7h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/></svg>
          </a>
        </div>
      </nav>
    </div>
  </div>

  <section id="core" class="hero section" aria-label="Core Offer">
    <div class="hero-media" id="heroMedia" aria-hidden="true"></div>
    <div class="hero-overlay" aria-hidden="true"></div>
    <div class="hero-content container">
      <!-- Simplified hero: logo + primary nav CTAs -->
      <img src="assets/Zanella Lounge Logo White.png" alt="Zanella Lounge" class="hero-logo" style="width: 640px; max-width: 80%; height:auto; display:block; margin:0 auto 18px;" />
      <div class="hero-ctas" style="justify-content:center">
        <a class="btn btn-ghost" href="#about">About</a>
        <a class="btn btn-ghost" href="#menuSection">Menu</a>
        <a class="btn btn-ghost" href="#contact">Contact</a>
      </div>
      <a href="#about" class="scroll-indicator" aria-label="Scroll to About">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 12l-7 7-7-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>
      <!-- keep headline/sub for JS hooks but visually hidden -->
      <h1 id="heroHeadline" style="display:none">ZANELLA Lounge</h1>
      <p id="heroSub" style="display:none"></p>
    </div>
  </section>

  <section id="about" class="about section">
    <div class="container">
      <div class="grid grid-2">
        <div class="reveal">
          <h2>About Us</h2>
          <p>ZANELLA Lounge is an elevated social space in Cluj-Napoca. <br>
            High Quality Food & Drinks.<br>
            Curated Music & Ambiance.<br>
            Weekly Themed Events.<br>
            Great Service.<br>
            Dress Code: Smart Casual. <br>
            (No sportswear, or overly casual attire)</p>
          </p>
          <div class="features">
            <span class="chip"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 12h16M4 12c0-4 3-7 8-7s8 3 8 7M4 12c0 4 3 7 8 7s8-3 8-7" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg> Elevated Comfort Food</span>
            <span class="chip chip--green"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 20l6-16 6 16M9.5 12h5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg> Craft Cocktails</span>
            <span class="chip"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg> Music & Social Nights</span>
          </div>
          <div style="height:48px;" aria-hidden="true"></div>
        </div>
        <div class="card reveal" style="overflow:hidden">
          <div style="aspect-ratio:4/3; background:linear-gradient(135deg, rgba(135,167,122,.1), rgba(195,154,107,.1)), url('assets/zanella_lounge_location_preview.jpg') center/cover; filter:saturate(.96) contrast(.97) brightness(.95)"></div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Menu — embedded collapsible menu (toggle below) -->
  <section id="menuSection" class="section">
    <div class="container">
      <div class="reveal">
        <div class="bg-panel">
          <h2>Menu</h2>
          <p class="inline-note">Tap the button to show or hide a sample of our menu.</p>
        </div>
        <div style="margin-top:12px;">
          <button id="menuToggleBtn" class="btn btn-gold" aria-expanded="false" aria-controls="embeddedMenu">Show Menu</button>
        </div>

  <div id="embeddedMenu" class="card embedded-menu-wrapper" aria-hidden="true">
          
          <div class="pricing-list">
            <h4 class="price-category">Bubbles (Prosecco & Champagne)</h4>
            <div class="gold-row"><div class="meta">Dom Pérignon Vintage (Bottle)</div><div class="price"><span class="amount">2200</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Moët & Chandon Brut (Bottle)</div><div class="price"><span class="amount">650</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Prosecco Superiore DOCG Valdobbiadene (Bottle)</div><div class="price"><span class="amount">280</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Prosecco DOC (Bottle)</div><div class="price"><span class="amount">180</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Wines by the Glass (150 ml)</h4>
            <div class="gold-row"><div class="meta">Boutique Import</div><div class="price"><span class="amount">45</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Italian Pinot Grigio / Merlot</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">House White</div><div class="price"><span class="amount">22</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">House Red</div><div class="price"><span class="amount">22</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Whiskies (Bottles)</h4>
            <div class="gold-row"><div class="meta">Macallan 18 Sherry Oak</div><div class="price"><span class="amount">2800</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Johnnie Walker Gold Label</div><div class="price"><span class="amount">750</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Jameson</div><div class="price"><span class="amount">450</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Rums (Bottles)</h4>
            <div class="gold-row"><div class="meta">Zacapa XO</div><div class="price"><span class="amount">1200</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Diplomatico Reserva Exclusiva</div><div class="price"><span class="amount">550</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Havana Club 7 Años</div><div class="price"><span class="amount">380</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Vodka & Tequila (Bottles)</h4>
            <div class="gold-row"><div class="meta">Clase Azul Reposado</div><div class="price"><span class="amount">3000</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Grey Goose</div><div class="price"><span class="amount">700</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Absolut</div><div class="price"><span class="amount">350</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Cocktails</h4>
            <div class="gold-row"><div class="meta">Zanella Gold Martini <div style="font-size:.9rem; color:rgba(255,255,255,.9)">(Saffron, Truffle, 24k Gold Leaf)</div></div><div class="price"><span class="amount">220</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Negroni</div><div class="price"><span class="amount">45</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Espresso Martini</div><div class="price"><span class="amount">42</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Aperol Spritz</div><div class="price"><span class="amount">32</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Whiskey Sour</div><div class="price"><span class="amount">42</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Mojito</div><div class="price"><span class="amount">38</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Cuba Libre</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Gin & Tonic</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Beers</h4>
            <div class="gold-row"><div class="meta">Seasonal Specialty Brew (0.33 L)</div><div class="price"><span class="amount">32</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Craft IPA (0.33 L)</div><div class="price"><span class="amount">26</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Imported Lager (0.33 L)</div><div class="price"><span class="amount">22</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Local Draft (0.5 L)</div><div class="price"><span class="amount">18</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Spritz & Light</h4>
            <div class="gold-row"><div class="meta">Prestige Spritz (with Premium Prosecco)</div><div class="price"><span class="amount">55</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Hugo Spritz</div><div class="price"><span class="amount">38</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Aperol Spritz</div><div class="price"><span class="amount">32</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Rosé Spritz</div><div class="price"><span class="amount">30</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Coffees & Teas</h4>
            <div class="gold-row"><div class="meta">Seasonal Reserve Coffee</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Latte Macchiato / Iced Latte</div><div class="price"><span class="amount">20-25</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Cappuccino</div><div class="price"><span class="amount">18</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Double Espresso</div><div class="price"><span class="amount">16</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Espresso</div><div class="price"><span class="amount">12</span><span class="currency">lei</span></div></div>

            <div class="gold-row"><div class="meta">Rare Estate Tea</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Curated Herbal Infusion</div><div class="price"><span class="amount">20</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Classic Tea Selection</div><div class="price"><span class="amount">15</span><span class="currency">lei</span></div></div>

            <h4 class="price-category">Non-Alcoholic & Mocktails</h4>
            <div class="gold-row"><div class="meta">Botanical Reserve Mocktail</div><div class="price"><span class="amount">35</span><span class="currency">lei</span></div></div>
            <div class="silver-row"><div class="meta">Virgin Mojito / Fresh Pressed Juice</div><div class="price"><span class="amount">20-25</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Soft Drinks</div><div class="price"><span class="amount">12</span><span class="currency">lei</span></div></div>
            <div class="gray-row"><div class="meta">Water Still / Sparkling (0.33 L)</div><div class="price"><span class="amount">10</span><span class="currency">lei</span></div></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Events — host your evening at Zanella Lounge -->
  <section id="events" class="section">
    <div class="container">
      <div class="grid grid-2">
        <div class="reveal">
          <h2>Host Your Evening With Us</h2>
          <p>Private events, tastings, and celebrations in our warm-industrial setting with craft cocktails and hosted service.</p>
          <ul style="margin-top:1.5rem; list-style:none; padding:0; display:flex; gap:.6rem; flex-wrap:wrap;">
            <li class="chip">Dedicated host & craft cocktails</li>
            <li class="chip chip--green">Flexible seating & private suites</li>
          </ul>
          <p style="margin-top:1.5rem" class="inline-note">Contact us to discuss your event.</p>
        </div>

        <div class="card reveal" style="padding:20px; overflow:hidden">
          <div style="aspect-ratio:4/3; border-radius:12px; overflow:hidden; background:linear-gradient(135deg, rgba(135,167,122,.08), rgba(195,154,107,.08)), url('assets/zanella_lounge_location_preview.jpg') center/cover; filter:saturate(.96) contrast(.97) brightness(.95)"></div>

          <div style="margin-top:14px; display:grid; gap:.6rem">
            <h3 style="margin:0">Pricing & Packages</h3>
            <p class="inline-note" style="margin:0">Starting rates (RON).</p>

            <div style="margin-top:8px">
              <button id="pricingToggleBtn" class="btn btn-ghost" aria-controls="embeddedPricing" aria-expanded="false">Show rental pricing</button>
            </div>

            <div id="embeddedPricing" class="bg-panel embedded-panel" style="margin-top:12px; padding:12px;" aria-hidden="true">
              <div class="pricing-list">
              <div class="pricing-row">
                <div class="meta">
                  <strong>Hourly Hire</strong>
                  <div style="font-size:.9rem; color:var(--muted)">Pay per hour — ideal for short gatherings (min. 2 hours)</div>
                </div>
                <div class="price">RON 200 / oră</div>
              </div>

              <div class="pricing-row">
                <div class="meta">
                  <strong>Multi‑Hour Package (3h)</strong>
                  <div style="font-size:.9rem; color:var(--muted)">Recommended for intimate events and tastings — includes welcome aperitivo</div>
                </div>
                <div class="price">RON 520</div>
              </div>

              <div class="pricing-row">
                <div class="meta">
                  <strong>Evening Hire (5h)</strong>
                  <div style="font-size:.9rem; color:var(--muted)">Standard evening slot — semi‑private layout and dedicated host</div>
                </div>
                <div class="price">RON 950</div>
              </div>

              <div class="pricing-row">
                <div class="meta">
                  <strong>Full‑Day Hire (10h)</strong>
                  <div style="font-size:.9rem; color:var(--muted)">Exclusive use, bespoke menu & staffing options</div>
                </div>
                <div class="price">RON 1.700+</div>
              </div>
              </div>
            </div>

            <p class="inline-note" style="margin:.6rem 0 0">Extras quoted separately. Contact us for details.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section style="padding-bottom: 10px;" id="contact" class="section">
    <div class="container">
      <div class="reveal">
        <div class="card" style="max-width:700px; margin:0 auto; padding:32px;">
          <h2 style="margin:0 0 8px; font-size:1.8rem;">Contact</h2>
          <p class="inline-note" style="margin:0 0 24px;">Get in touch for bookings or inquiries.</p>
          
          <div id="contactInfo" style="display:grid; gap:20px;">
            <div style="display:flex; gap:.8rem; flex-wrap:wrap;">
              <a class="btn btn-green" href="tel:+40123456789" aria-label="Call Zanella Lounge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M22 16.92v3.08a1 1 0 0 1-1.08 1A19 19 0 0 1 3.08 3.08 1 1 0 0 1 4.08 2h3.08a1 1 0 0 1 1 .75c.12.5.32 1.02.6 1.5l-.9.9a1 1 0 0 0-.22 1.11 12.36 12.36 0 0 0 5.23 5.23 1 1 0 0 0 1.11-.22l.9-.9c.48.28 1 .48 1.5.6a1 1 0 0 1 .75 1V16.92z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                +40770388369
              </a>
              <a class="btn" href="mailto:hello@zanellalounge.example" aria-label="Email Zanella Lounge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 8.2v7.6a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V8.2" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 6H3v2.2l9 6 9-6V6z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                zan15592@gmail.com
              </a>
            </div>
            
            <div style="display:flex; gap:.8rem; flex-wrap:wrap;">
              <a class="btn btn-ghost" href="https://www.instagram.com/zanella_lounge/" aria-label="Instagram" target="_blank" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 8.6a3.4 3.4 0 1 0 0 6.8 3.4 3.4 0 0 0 0-6.8z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M17.8 6.2h.01" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
                Instagram
              </a>
              <a class="btn btn-ghost" href="https://www.facebook.com/profile.php?id=61580371774552" aria-label="Facebook" target="_blank" rel="noopener">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v7h4v-7h3l1-4h-4V6a1 1 0 0 1 1-1h3z" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                Facebook
              </a>
            </div>
            
            <div style="padding-top:20px; border-top:1px solid var(--line);">
              <h3 style="margin:0 0 8px; font-size:1.1rem; color:var(--text);">Visit</h3>
              <p style="margin:4px 0; color:var(--text);">Strada Ciocarliei 15, Cluj‑Napoca</p>
              <p class="inline-note" style="margin:4px 0 0;">Open Tue–Sun · 17:00–01:00</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap">
      <span>&copy; <span id="year"></span> Zanella Lounge</span>
      <span style="display:flex; gap:12px"><a href="https://www.instagram.com/zanella_lounge/">Instagram</a><a href="https://www.facebook.com/profile.php?id=61580371774552">Facebook</a></span>
    </div>
  </footer>

  <script>
    // Content Loader — Load JSON files and populate content
    window.contentLoaded = (async function loadContent() {
      try {
        // Load all JSON files in parallel
        const [navData, heroData, aboutData, menuData, eventsData, contactData, footerData] = await Promise.all([
          fetch('content/nav.json').then(r => r.json()),
          fetch('content/hero.json').then(r => r.json()),
          fetch('content/about.json').then(r => r.json()),
          fetch('content/menu.json').then(r => r.json()),
          fetch('content/events.json').then(r => r.json()),
          fetch('content/contact.json').then(r => r.json()),
          fetch('content/footer.json').then(r => r.json())
        ]);

        // Populate Navigation
        const navBrand = document.querySelector('.nav .brand');
        if (navBrand && navData.brand) {
          navBrand.href = navData.brand.href;
          navBrand.innerHTML = `<img src="${navData.brand.logo}" alt="${navData.brand.alt}" style="padding:5px; padding-right:40px; height:28px; display:block; object-fit:contain;">`;
        }
        const navLinks = document.querySelector('.nav-links');
        if (navLinks && navData.links) {
          navLinks.innerHTML = navData.links.map(link => `<a href="${link.href}">${link.text}</a>`).join('');
        }
        const navSocial = document.querySelector('.nav-social');
        if (navSocial && navData.social) {
          navSocial.innerHTML = navData.social.map(s => `<a href="${s.url}" aria-label="${s.ariaLabel}" target="_blank" rel="noopener" style="color:var(--muted); display:inline-flex; align-items:center;">${s.icon}</a>`).join('');
        }

        // Populate Hero
        const heroLogo = document.querySelector('.hero-logo');
        if (heroLogo && heroData.logo) {
          heroLogo.src = heroData.logo.src;
          heroLogo.alt = heroData.logo.alt;
          heroLogo.style.width = heroData.logo.width;
          heroLogo.style.maxWidth = heroData.logo.maxWidth;
        }
        const heroCtas = document.querySelector('.hero-ctas');
        if (heroCtas && heroData.ctas) {
          heroCtas.innerHTML = heroData.ctas.map(cta => `<a class="${cta.class}" href="${cta.href}">${cta.text}</a>`).join('');
        }

        // Populate About
        const aboutTitle = document.querySelector('#about h2');
        if (aboutTitle && aboutData.title) aboutTitle.textContent = aboutData.title;
        const aboutDesc = document.querySelector('#about .reveal p');
        if (aboutDesc && aboutData.description) aboutDesc.innerHTML = aboutData.description;
        const aboutFeatures = document.querySelector('#about .features');
        if (aboutFeatures && aboutData.features) {
          aboutFeatures.innerHTML = aboutData.features.map(f => `<span class="${f.class}">${f.icon} ${f.text}</span>`).join('');
        }

        // Populate Menu
        const menuTitle = document.querySelector('#menuSection .bg-panel h2');
        if (menuTitle && menuData.title) menuTitle.textContent = menuData.title;
        const menuDesc = document.querySelector('#menuSection .bg-panel .inline-note');
        if (menuDesc && menuData.description) menuDesc.textContent = menuData.description;
        const menuToggleBtn = document.getElementById('menuToggleBtn');
        if (menuToggleBtn && menuData.toggleButton) {
          menuToggleBtn.textContent = menuData.toggleButton.text;
          menuToggleBtn.className = menuData.toggleButton.class;
          window.MENU_BUTTON_TEXTS = {
            show: menuData.toggleButton.text,
            hide: menuData.toggleButton.textHide
          };
        }
        const menuList = document.querySelector('#embeddedMenu .pricing-list');
        if (menuList && menuData.categories) {
          menuList.innerHTML = menuData.categories.map(cat => {
            let html = `<h4 class="price-category">${cat.name}</h4>`;
            html += cat.items.map(item => {
              let metaHtml = item.name;
              if (item.description) metaHtml += ` <div style="font-size:.9rem; color:rgba(255,255,255,.9)">${item.description}</div>`;
              return `<div class="${item.class}"><div class="meta">${metaHtml}</div><div class="price"><span class="amount">${item.price}</span><span class="currency">${item.currency}</span></div></div>`;
            }).join('');
            return html;
          }).join('');
        }

        // Populate Events
        const eventsTitle = document.querySelector('#events h2');
        if (eventsTitle && eventsData.title) eventsTitle.textContent = eventsData.title;
        const eventsDesc = document.querySelector('#events .reveal p');
        if (eventsDesc && eventsData.description) eventsDesc.textContent = eventsData.description;
        const eventsFeatures = document.querySelector('#events .reveal ul');
        if (eventsFeatures && eventsData.features) {
          eventsFeatures.innerHTML = eventsData.features.map(f => `<li class="${f.class}">${f.text}</li>`).join('');
        }
        const eventsNote = document.querySelector('#events .inline-note');
        if (eventsNote && eventsData.note) eventsNote.textContent = eventsData.note;
        const pricingTitle = document.querySelector('#events h3');
        if (pricingTitle && eventsData.pricing) pricingTitle.textContent = eventsData.pricing.title;
        const pricingDesc = document.querySelector('#events .card .inline-note');
        if (pricingDesc && eventsData.pricing) pricingDesc.textContent = eventsData.pricing.description;
        const pricingToggleBtn = document.getElementById('pricingToggleBtn');
        if (pricingToggleBtn && eventsData.pricing.toggleButton) {
          pricingToggleBtn.textContent = eventsData.pricing.toggleButton.text;
          window.PRICING_BUTTON_TEXTS = {
            show: eventsData.pricing.toggleButton.text,
            hide: eventsData.pricing.toggleButton.textHide
          };
        }
        const pricingList = document.querySelector('#embeddedPricing .pricing-list');
        if (pricingList && eventsData.pricing.packages) {
          pricingList.innerHTML = eventsData.pricing.packages.map(pkg => 
            `<div class="pricing-row">
              <div class="meta">
                <strong>${pkg.name}</strong>
                <div style="font-size:.9rem; color:var(--muted)">${pkg.description}</div>
              </div>
              <div class="price">${pkg.price}</div>
            </div>`
          ).join('');
        }
        const pricingExtras = document.querySelector('#events .card .inline-note:last-of-type');
        if (pricingExtras && eventsData.pricing.extrasNote) pricingExtras.textContent = eventsData.pricing.extrasNote;

        // Populate Contact
        const contactTitle = document.querySelector('#contact .bg-panel h2');
        if (contactTitle && contactData.title) contactTitle.textContent = contactData.title;
        const contactDescs = document.querySelectorAll('#contact .bg-panel .inline-note');
        if (contactDescs.length && contactData.description) {
          contactDescs.forEach((desc, i) => {
            if (contactData.description[i]) desc.textContent = contactData.description[i];
          });
        }
        const contactInfo = document.getElementById('contactInfo');
        if (contactInfo && contactData.contactInfo) {
          const phoneBtn = contactInfo.querySelector('.btn-green');
          if (phoneBtn && contactData.contactInfo.phone) {
            phoneBtn.href = contactData.contactInfo.phone.href;
            phoneBtn.innerHTML = `${contactData.contactInfo.phone.icon} ${contactData.contactInfo.phone.number}`;
          }
          const emailBtn = contactInfo.querySelector('.btn:not(.btn-green)');
          if (emailBtn && contactData.contactInfo.email) {
            emailBtn.href = contactData.contactInfo.email.href;
            emailBtn.innerHTML = `${contactData.contactInfo.email.icon} ${contactData.contactInfo.email.address}`;
          }
          const socialBtns = contactInfo.querySelectorAll('.btn-ghost');
          if (socialBtns.length && contactData.social) {
            socialBtns.forEach((btn, i) => {
              if (contactData.social[i]) {
                btn.href = contactData.social[i].url;
                btn.innerHTML = `${contactData.social[i].icon} ${contactData.social[i].platform}`;
              }
            });
          }
        }
        const visitTitle = document.querySelector('#contact h3');
        if (visitTitle && contactData.visit) visitTitle.textContent = contactData.visit.title;
        const visitAddress = document.querySelector('#contactInfo > div:last-child p:nth-of-type(1)');
        if (visitAddress && contactData.visit) {
          visitAddress.textContent = contactData.visit.address;
        }
        const visitHours = document.querySelector('#contactInfo > div:last-child p:nth-of-type(2)');
        if (visitHours && contactData.visit) {
          visitHours.textContent = contactData.visit.hours;
        }

        // Populate Footer
        const footerCopyright = document.querySelector('footer span:first-child');
        if (footerCopyright && footerData.copyright) {
          footerCopyright.innerHTML = `&copy; <span id="year"></span> ${footerData.copyright}`;
        }
        const footerSocial = document.querySelector('footer span:last-child');
        if (footerSocial && footerData.social) {
          footerSocial.innerHTML = footerData.social.map(s => `<a href="${s.url}">${s.text}</a>`).join('');
        }

        // Update SLIDES constant from heroData
        if (heroData.slides) {
          window.SLIDES_FROM_JSON = heroData.slides;
        }
        
        return true; // Signal that content is loaded
      } catch (error) {
        console.error('Error loading content:', error);
        return false;
      }
    })();

    // Config — we keep multiple slide sources but only display the primary one (no swapping)
    const SLIDES = [
      { title: "ZANELLA Lounge", sub: "Warm & Cozy Atmosphere and an intimate experience", image: "assets/zanella_image_1.jpg" },
      { title: "Elevated Social. Effortless Vibe.", sub: "Concrete, wood, plants, and light — built for connection.", image: "assets/zanella_image_2.jpg" },
      { title: "Smart Casual & Professional Setting", sub: "Refined space. Smart-casual nights. Your table, your people.", image: "assets/zanella_image_3.jpg" }
    ];
    const TICKET_URL = "https://your-ticketing-url.example.com";

    // Set --vh CSS variable for mobile browser viewport handling
    (function setVh(){
      function update(){
        try{ document.documentElement.style.setProperty('--vh', (window.innerHeight * 0.01) + 'px'); }catch(e){}
      }
      update();
      window.addEventListener('resize', update);
      window.addEventListener('orientationchange', update);
    })();

    // Elements
    const heroMedia = document.getElementById('heroMedia');
    const heroHeadline = document.getElementById('heroHeadline');
    const heroSub = document.getElementById('heroSub');
    const ticketBtn = document.getElementById('ticketBtn');

    // Hero: mount single slide (primary image) and lightly animate it via CSS keyframes above.
    function mountSlides(){
      const slides = window.SLIDES_FROM_JSON || SLIDES;
      const primary = slides[0];
      if (primary) {
        heroMedia.innerHTML = `<div class="slide" style="background-image:url('${primary.image}')"></div>`;
        heroHeadline.textContent = primary.title;
        heroSub.textContent = primary.sub;
      }
    }

    // Reveal
    const io = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('visible'); io.unobserve(e.target); } }) }, {threshold:.14});
    function enableReveal(){ document.querySelectorAll('.reveal').forEach(el=> io.observe(el)); }

    // Smooth anchors
    document.querySelectorAll('a[href^="#"]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        const id=a.getAttribute('href');
        if(id.length>1){
          e.preventDefault();
          const el=document.querySelector(id);
          if(el){
            el.scrollIntoView({behavior:'smooth', block:'start'});
            // If navigating to the menu section, open the embedded menu automatically
            if(id === '#menuSection'){
              setTimeout(()=>{ window.openEmbeddedMenu?.(); }, 420);
            }
          }
        }
      });
    });

    // Particles
    const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const canvas = document.getElementById('particles'); const ctx = canvas.getContext('2d');
    let W=0, H=0, particles=[], raf=null, particlesRunning=false;
    const MAX_LINKS_PER=3, LINK_DIST=110;
    function resize(){ W=canvas.width=window.innerWidth; H=canvas.height=window.innerHeight; if(particles.length){ particles.forEach(p=>{ p.x=Math.random()*W; p.y=Math.random()*H; }); } }
    window.addEventListener('resize', resize);
    function makeParticles(count=80){ particles = Array.from({length:count}, ()=>({ x:Math.random()*W, y:Math.random()*H, vx:(Math.random()-.5)*.35, vy:(Math.random()-.5)*.35, r:Math.random()*1.6+.8, c:Math.random()>.5?'rgba(195,154,107,.65)':'rgba(222,186,120,.7)', links:0 })); }
    function draw(){ ctx.clearRect(0,0, W,H); for(let i=0;i<particles.length;i++){ const p=particles[i]; p.links=0; for(let j=i+1;j<particles.length && p.links<MAX_LINKS_PER;j++){ const q=particles[j]; const dx=p.x-q.x, dy=p.y-q.y; const d=Math.hypot(dx,dy); if(d<LINK_DIST){ ctx.globalAlpha=(LINK_DIST-d)/LINK_DIST*.12; ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y); ctx.strokeStyle='rgba(195,154,107,1)'; ctx.lineWidth=1; ctx.stroke(); ctx.globalAlpha=1; p.links++; } } }
      for(const p of particles){ p.x+=p.vx; p.y+=p.vy; if(p.x<0||p.x>W) p.vx*=-1; if(p.y<0||p.y>H) p.vy*=-1; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.c; ctx.fill(); }
      raf=requestAnimationFrame(draw);
    }

    function startParticles(){ if(particlesRunning) return; resize(); makeParticles(window.innerWidth<640?50:90); if(!prefersReduced){ particlesRunning=true; draw(); } else { ctx.clearRect(0,0,W,H); for(const p of particles){ ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.c; ctx.fill(); } } }
    function stopParticles(){ if(raf) cancelAnimationFrame(raf); raf=null; particlesRunning=false; }

    // Init
    window.addEventListener('DOMContentLoaded', async ()=>{
      // Wait for content to load before initializing
      await window.contentLoaded;
      mountSlides(); enableReveal();
      const yearEl=document.getElementById('year'); if(yearEl) yearEl.textContent=new Date().getFullYear();
      if(ticketBtn) ticketBtn.href=TICKET_URL;
      startParticles();
      // initial random styles for pricing rows
      try{ window.randomizePricingLooks && window.randomizePricingLooks(); }catch(e){}
    });

    // Visibility handling (only control particles since there is no rotator)
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ stopParticles(); } else { startParticles(); } });

    // --- Minimal self-tests (run after load) ---
    function test(name, ok){ console[(ok?'log':'error')](`TEST ${ok?'PASS':'FAIL'}: ${name}`); }
    window.addEventListener('load', ()=>{
      test('SLIDES populated', SLIDES.length>=1);
      test('Hero slide mounted', document.querySelectorAll('.slide').length>=1);
      test('Particles canvas sized', canvas.width>0 && canvas.height>0);
    });

    // Embedded menu toggle (show/hide) — class-based to enable smooth animation
    (function(){
      const btn = document.getElementById('menuToggleBtn');
      const panel = document.getElementById('embeddedMenu');
      if(!btn || !panel) return;

  // ensure panel is removed from flow when initially closed
  if(!panel.classList.contains('open')) panel.style.display = 'none';

  function openMenu(){
    // ensure element participates in layout before animating
    panel.style.display = 'block';
    // next frame, add class to trigger transition
    requestAnimationFrame(()=>{
      panel.classList.add('open');
      panel.setAttribute('aria-hidden','false');
      btn.textContent = (window.MENU_BUTTON_TEXTS && window.MENU_BUTTON_TEXTS.hide) || 'Hide Menu'; btn.setAttribute('aria-expanded','true');
      panel.querySelectorAll('a,button')[0]?.focus();
      // apply randomized looks when opening
      try{ window.randomizePricingLooks && window.randomizePricingLooks(); }catch(e){}
    });
  }

  function closeMenu(){
    // remove open class to animate closed state
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden','true');
    btn.textContent = (window.MENU_BUTTON_TEXTS && window.MENU_BUTTON_TEXTS.show) || 'Show Menu'; btn.setAttribute('aria-expanded','false'); btn.focus();
    // after transition ends, remove from flow to avoid blocking scroll
    const onTransEnd = (ev)=>{ if(ev.target!==panel) return; panel.style.display = 'none'; panel.removeEventListener('transitionend', onTransEnd); };
    panel.addEventListener('transitionend', onTransEnd);
  }

  // expose for programmatic control
  window.openEmbeddedMenu = openMenu;
  window.closeEmbeddedMenu = closeMenu;

      btn.addEventListener('click', ()=>{ panel.classList.contains('open')? closeMenu() : openMenu(); });

      // close on Escape
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && panel.classList.contains('open')) closeMenu(); });

      // click outside to close (respecting button)
      document.addEventListener('click', (e)=>{ if(!panel.classList.contains('open')) return; if(panel.contains(e.target) || btn.contains(e.target)) return; closeMenu(); });
    })();

    // Embedded pricing toggle (mirror of menu toggle)
    (function(){
      const btn = document.getElementById('pricingToggleBtn');
      const panel = document.getElementById('embeddedPricing');
      if(!btn || !panel) return;

  function openPricing(){ panel.classList.add('open'); panel.setAttribute('aria-hidden','false'); btn.textContent = (window.PRICING_BUTTON_TEXTS && window.PRICING_BUTTON_TEXTS.hide) || 'Hide rental pricing'; btn.setAttribute('aria-expanded','true'); panel.querySelectorAll('a,button')[0]?.focus(); }
  function closePricing(){ panel.classList.remove('open'); panel.setAttribute('aria-hidden','true'); btn.textContent = (window.PRICING_BUTTON_TEXTS && window.PRICING_BUTTON_TEXTS.show) || 'Show rental pricing'; btn.setAttribute('aria-expanded','false'); btn.focus(); }
  window.openEmbeddedPricing = openPricing;
  window.closeEmbeddedPricing = closePricing;

      btn.addEventListener('click', ()=>{ panel.classList.contains('open')? closePricing() : openPricing(); });

      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && panel.classList.contains('open')) closePricing(); });
      document.addEventListener('click', (e)=>{ if(!panel.classList.contains('open')) return; if(panel.contains(e.target) || btn.contains(e.target)) return; closePricing(); });
    })();

    // Randomize pricing row looks (temporary visual demo) — with per-row colored particles for gold/silver
    (function(){
      function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

      function createCanvas(row){
        // respect reduced motion preference
        const reduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        // remove existing canvas
        const existing = row.querySelector('.row-canvas');
        if(existing) existing.remove();
        const c = document.createElement('canvas');
        c.className = 'row-canvas';
        row.prepend(c);
        // size and animate
        const ctx = c.getContext('2d');
        function resize(){
          const ratio = window.devicePixelRatio || 1;
          const rect = c.getBoundingClientRect();
          c.width = Math.max(1, Math.round(rect.width * ratio));
          c.height = Math.max(1, Math.round(rect.height * ratio));
          c.style.width = rect.width + 'px';
          c.style.height = rect.height + 'px';
          ctx.setTransform(ratio,0,0,ratio,0,0);
        }
        resize();

        // if user prefers reduced motion, return no-op animation controls
        if(reduced){
          return { resize, start: ()=>{}, stop: ()=>{ const ex = c; try{ ctx.clearRect(0,0,c.width,c.height); }catch(e){} } };
        }

        // lighter particle set: fewer, smaller, subtler alpha
        const particles = Array.from({length:3}, ()=>({ x: Math.random()*c.width, y: Math.random()*c.height, vx:(Math.random()-.5)*.36, vy:(Math.random()-.5)*.18, r: Math.random()*1.2 + .4, life: Math.random()*100 + 60, a: Math.random()*0.45 + 0.08 }));
        let rafId=null; let frame=0;
        function draw(color){
          frame++;
          // update positions every frame but draw only every 2 frames to reduce work
          for(const p of particles){
            p.x += p.vx; p.y += p.vy; p.life--;
            if(p.x<0||p.x>c.width) p.vx *= -1;
            if(p.y<0||p.y>c.height) p.vy *= -1;
            if(p.life<=0){ Object.assign(p, { x: Math.random()*c.width, y: Math.random()*c.height, vx:(Math.random()-.5)*.36, vy:(Math.random()-.5)*.18, r: Math.random()*1.2 + .4, life: Math.random()*100 + 60, a: Math.random()*0.45 + 0.08 }); }
          }
          if(frame % 2 !== 0){ rafId = requestAnimationFrame(()=> draw(color)); return; }

          ctx.clearRect(0,0,c.width,c.height);
          for(const p of particles){
            ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            ctx.fillStyle = color; ctx.globalAlpha = Math.min(0.55, p.a); ctx.fill(); ctx.globalAlpha = 1;
          }
          rafId = requestAnimationFrame(()=> draw(color));
        }
        // return control functions
        return { resize, start: draw, stop: ()=>{ if(rafId) cancelAnimationFrame(rafId); rafId=null; ctx.clearRect(0,0,c.width,c.height); } };
      }

      function applyRandom(){
        const variants = ['gold-row','silver-row','gray-row'];
        // target item rows inside the pricing list (direct div children) to include user-provided rows
        const rows = document.querySelectorAll('#embeddedMenu .pricing-list > div, #embeddedMenu .premium-row');
        rows.forEach(r => {
          // If the row already has an explicit variant class from markup, preserve it.
          if (r.classList.contains('gold-row') || r.classList.contains('silver-row') || r.classList.contains('gray-row')) {
            // ensure animations exist for gold/silver rows added via markup
            if ((r.classList.contains('gold-row') || r.classList.contains('silver-row')) && !r._rowAnim) {
              const ex = r.querySelector('.row-canvas'); if (ex) ex.remove();
              const anim = createCanvas(r);
              const color = r.classList.contains('gold-row') ? 'rgba(255,230,180,0.9)' : 'rgba(200,200,210,0.9)';
              anim.start(color);
              r._rowAnim = anim;
              const onResize = () => anim.resize();
              window.addEventListener('resize', onResize);
              r._removeResize = () => window.removeEventListener('resize', onResize);
            }
            // ensure gray rows do not keep a leftover animation
            if (r.classList.contains('gray-row') && r._rowAnim) {
              try { r._rowAnim.stop(); } catch(e) {}
              r._rowAnim = null;
              const ex = r.querySelector('.row-canvas'); if (ex) ex.remove();
              if (r._removeResize) { try { r._removeResize(); } catch(e) {} r._removeResize = null; }
            }
            return; // keep explicit assignments
          }

          // For rows without an explicit variant, assign one randomly
          r.classList.remove('gold-row','silver-row','gray-row');
          const v = pick(variants);
          r.classList.add(v);

          // cleanup any existing animation store
          if (r._rowAnim) {
            try { r._rowAnim.stop(); } catch(e) {}
            r._rowAnim = null;
            if (r._removeResize) { try { r._removeResize(); } catch(e) {} r._removeResize = null; }
          }

          // attach canvas and animate only for gold/silver
          if (v === 'gold-row' || v === 'silver-row'){
            const anim = createCanvas(r);
            const color = v === 'gold-row' ? 'rgba(255,230,180,0.9)' : 'rgba(200,200,210,0.9)';
            anim.start(color);
            r._rowAnim = anim;
            const onResize = ()=> anim.resize();
            window.addEventListener('resize', onResize);
            r._removeResize = ()=> window.removeEventListener('resize', onResize);
          } else {
            // for gray rows ensure any existing canvas removed
            const ex = r.querySelector('.row-canvas'); if (ex) ex.remove();
          }
        });
      }
      // expose for manual calls
      window.randomizePricingLooks = applyRandom;
    })();

    // Premium gold particle animation
    (function(){
      const canvas = document.getElementById('premiumCanvas');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      let W=0, H=0, particles=[], rafId=null;

      function resizeCanvas(){
        const ratio = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        W = Math.round(rect.width) || 0;
        H = Math.round(rect.height) || 0;
        // ensure the canvas element has explicit CSS pixel size (helps when 100% height is ambiguous)
        canvas.style.width = (W || 0) + 'px';
        canvas.style.height = (H || 0) + 'px';
        // set backing store to device pixels
        canvas.width = Math.max(1, Math.round(W * ratio));
        canvas.height = Math.max(1, Math.round(H * ratio));
        // scale drawing so coordinates are in CSS pixels
        ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
      }

      function makeParticles(n){
        particles = Array.from({length: n}, ()=>({
          x: Math.random()*W,
          y: Math.random()*H,
          vx: (Math.random()-.5) * 0.6,        // gentle horizontal drift
          vy: (Math.random()-.5) * 0.28,       // gentle vertical drift
          r: Math.random()*1.6 + 0.6,         // small radius
          life: Math.random()*160 + 80,       // longer lifetime for subtle motion
          a: Math.random()*0.6 + 0.18        // particle alpha multiplier (slightly stronger)
        }));
      }

      function draw(){
  // clear using CSS pixels (context is scaled to device pixels)
  ctx.clearRect(0,0, W, H);
        for(const p of particles){
          // gentle sway for more natural motion
          p.vx += Math.sin((p.x + p.y + performance.now()*0.0008) ) * 0.001;
          p.vy += Math.cos((p.y - p.x + performance.now()*0.0009) ) * 0.0008;
          p.x += p.vx; p.y += p.vy;
          p.life--;

          // keep inside bounds with soft bounce
          if(p.x < 0) { p.x = 0; p.vx *= -0.6; }
          if(p.x > W) { p.x = W; p.vx *= -0.6; }
          if(p.y < 0) { p.y = 0; p.vy *= -0.6; }
          if(p.y > H) { p.y = H; p.vy *= -0.6; }

          // radial shimmer, much more transparent than before
          ctx.beginPath();
            const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r*5);
            // slightly stronger stops so shimmer is visible but still soft
            const alphaBoost = Math.min(1, p.a * 1.1); // +10% opacity, clamp to 1
            g.addColorStop(0, `rgba(255,243,210,${(alphaBoost * 0.7).toFixed(3)})`);
            g.addColorStop(0.25, `rgba(255,223,130,${(alphaBoost * 0.45).toFixed(3)})`);
            g.addColorStop(0.6, `rgba(195,154,107,${(alphaBoost * 0.12).toFixed(3)})`);
          g.addColorStop(1, 'rgba(195,154,107,0)');
          ctx.fillStyle = g;
          ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
          ctx.fill();

          // respawn when life ends (anywhere in area) for distributed shimmer
          if(p.life <= 0){
            Object.assign(p, {
              x: Math.random()*W,
              y: Math.random()*H,
              vx: (Math.random()-.5) * 0.6,
              vy: (Math.random()-.5) * 0.28,
              r: Math.random()*1.6 + 0.6,
              life: Math.random()*160 + 80,
              a: Math.random()*0.45 + 0.12
            });
          }
        }
        rafId = requestAnimationFrame(draw);
      }

      function start(){
        if(rafId) return;
        // ensure we have a measured size (menu open transitions may yield 0 initially)
        resizeCanvas();
        if(!W || !H){
          // wait for layout and try again on next frame
          requestAnimationFrame(()=> start());
          return;
        }
        // particle count based on CSS width (higher min ensures visibility)
        const count = Math.max(18, Math.round((W / 320) * 14));
        makeParticles(count);
        // draw after a tiny delay so any CSS transitions finish and sizes are stable
        setTimeout(()=> draw(), 80);
        window.addEventListener('resize', resizeCanvas);
      }

      function stop(){
        if(rafId) cancelAnimationFrame(rafId);
        rafId = null;
        window.removeEventListener('resize', resizeCanvas);
        ctx.clearRect(0,0, canvas.width, canvas.height);
      }

      // Observe the embedded menu for open state
      const embedded = document.getElementById('embeddedMenu');
      if(!embedded) return;
      const mo = new MutationObserver((list)=>{
        for(const m of list){ if(m.attributeName==='class'){ const open = embedded.classList.contains('open'); if(open) start(); else stop(); } }
      });
      mo.observe(embedded, { attributes:true });
      // start if already open on load
      if(embedded.classList.contains('open')) start();
    })();
  </script>
</body>
</html>
